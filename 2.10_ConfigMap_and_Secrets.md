# ConfigMap and Secrets
## Arguments
Script generator:
```shell
#!/bin/bash
trap "exit" SIGINT
INTERVAL=$1
echo "Genarate html fole with date every $INTERVAL seconds"
while :
do
  echo $(date) Writing date to /var/html/index.html
  echo $(date) > /var/html/index.html
  sleep $INTERVAL
done
```
Dockerfile:
```dockerfile
FROM ubuntu:latest
RUN apt-get update; apt-get -y install nfs-common
ADD date.sh /bin/date.sh
ENTRYPOINT ["/bin/date.sh"]
CMD ["10"]
```
Pod example:
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-date
spec:
  containers:
    - image: nginx:1.20
      name: web
      volumeMounts:
        - mountPath: /usr/share/nginx/html
          name: html
          readOnly: true
    - image: artemshestakov/date:1.1
      name: generator
      volumeMounts:
        - mountPath: /var/html
          name: html
      args: ["5"]
      ports:
        - name: http
          containerPort: 80
          protocol: TCP
  volumes:
    - name: html
      emptyDir: {}
```

## Environmeny variables
```shell
#!/bin/bash
trap "exit" SIGINT
echo "Genarate html fole with date every $INTERVAL seconds"
while :
do
  echo $(date) Writing date to /var/html/index.html
  echo $(date) > /var/html/index.html
  sleep $INTERVAL
done
```
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-date
spec:
  containers:
    - image: nginx:1.20
      name: web
      volumeMounts:
        - mountPath: /usr/share/nginx/html
          name: html
          readOnly: true
    - image: artemshestakov/date:env
      name: generator
      volumeMounts:
        - mountPath: /var/html
          name: html
      env:
        - name: INTERVAL
          value: "5"
      ports:
        - name: http
          containerPort: 80
          protocol: TCP
  volumes:
    - name: html
      emptyDir: {}
```
>You can use one variable as part of another
```yaml
env:
  - name: FIRST
    value: "5"
  - name: SECOND_INTERVAL
    value: "1$(INTERVAL)" # -> 15 sec
```

## ConfigMap
```shell
# from literal
k create cm interval --from-literal=interval=15
configmap/interval created

# from file
k create cm nginx --from-file=nginx/nginx.conf 
configmap/nginx created

# from directory
k create cm nginx-dir --from-file=nginx/
configmap/nginx-dir created
```
### ConfigMap as environment variable
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-date-cm
spec:
  containers:
    - image: nginx:1.20
      name: web
      volumeMounts:
        - mountPath: /usr/share/nginx/html
          name: html
          readOnly: true
    - image: artemshestakov/date:env
      name: generator
      volumeMounts:
        - mountPath: /var/html
          name: html
      env:
        - name: INTERVAL
          valueFrom:
            configMapKeyRef:
              name: interval
              key: interval
      ports:
        - name: http
          containerPort: 80
          protocol: TCP
  volumes:
    - name: html
      emptyDir: {}
```
or
```yaml
containers:
  envFrom:
    - prefix: FOOBAR_
      configMapRef: 
        name: foobar.conf 
```
### ConfigMap as cmd
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-date-cmd
spec:
  containers:
    - image: nginx:1.20
      name: web
      volumeMounts:
        - mountPath: /usr/share/nginx/html
          name: html
          readOnly: true
    - image: artemshestakov/date:1.1
      name: generator
      volumeMounts:
        - mountPath: /var/html
          name: html
      env:                    # init vars
        - name: INTERVAL
          valueFrom:
            configMapKeyRef:
              name: interval
              key: interval
      args:
        - $(INTERVAL)         # use var in args
      ports:
        - name: http
          containerPort: 80
          protocol: TCP
  volumes:
    - name: html
      emptyDir: {}
```
### ConfigMap as file
```shell
k create cm date-generator --from-file nginx/nginx.conf --from-literal interval=30
configmap/date-generator created
```
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-date-file
spec:
  containers:
    - image: nginx:1.20
      name: web
      volumeMounts:
        - mountPath: /usr/share/nginx/html
          name: html
          readOnly: true
        - mountPath: /etc/nginx/conf.d
          name: config
          readOnly: true
    - image: artemshestakov/date:env
      name: generator
      volumeMounts:
        - mountPath: /var/html
          name: html
      env:
        - name: INTERVAL
          valueFrom:
            configMapKeyRef:
              name: date-generator
              key: interval
      ports:
        - name: http
          containerPort: 80
          protocol: TCP
  volumes:
    - name: html
      emptyDir: {}
    - name: config
      configMap:
        name: date-generator
```